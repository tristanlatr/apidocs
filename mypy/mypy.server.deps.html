<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "DTD/xhtml1-strict.dtd">
<html>
  

  <head>
    
    <title>mypy.server.deps</title>
    <meta name="generator" content="pydoctor 21.2.2"> 
        
    </meta>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=0.75" />
    <link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="apidocs.css" />
    <link rel="stylesheet" type="text/css" href="extra.css" />
</head>

  <body>

    

    <nav class="navbar navbar-default">
  
  <div class="container">

    <div class="navbar-header">
      
      <div class="navlinks">
        <span class="navbar-brand">
          <a href="https://github.com/python/mypy" class="projecthome">mypy-0.930</a> <a href="index.html">API Documentation</a>
        </span>

        <a href="moduleIndex.html">
          Modules
        </a>

        <a href="classIndex.html">
          Classes
        </a>

        <a href="nameIndex.html">
          Names
        </a>

        <form action="search-results.html" id="search-box-container">
          <div class="input-group">
            <input id="search-box" name="search-query" placeholder="Search..." aria-label="Search" minlength="2" class="form-control" />
            <span class="input-group-btn">
              <button class="btn btn-default" type="submit" title="Search"><img src="fonts/search.svg" alt="Search!" /></button>
              <a class="btn btn-default" id="search-help-button" title="Help" onclick="toggleSearchHelpText()"><img src="fonts/info.svg" alt="Help!" /></a>
            </span>
          </div>
        </form>

        <div class="rst-admonition hint" id="search-help-box">
          <p class="rst-last">
      
            Search bar offers the following options:
            <ul>   
                <li>
                  <strong>Term presence.</strong> The below example searches for documents that 
                    must contain “foo”, might contain “bar” and must not contain “baz”:
                  <br /> <code>'+foo bar -baz'</code>
                </li> 

                <li>
                  <strong>Wildcards.</strong> The below example searches for documents with words beginning with “foo”:
                  <br /> <code>'foo*'</code>
                </li> 

                <li>
                  <strong>Search in specific fields.</strong> The following search matches all documents 
                  that contains "foo" in their full dotted name and with “bar” in any field:
                  <br /> <code>'+fullName:*foo* +bar'</code>

                  <p>
                    Possible fields: 'name', 'docstring', 'fullName'.
                  </p>
                </li>

                <li>
                  <strong>Fuzzy matches.</strong> The following search matches all documents 
                  that have a word within 1 edit distance of “foo”:
                  <br /> <code>'foo~1'</code>
                </li>
            </ul>

          </p>
        </div>

      </div>


    </div>
  </div>

  <script>
 
    function toggleSearchHelpText() {
        document.body.classList.toggle("search-help-hidden");
    }
    // Init search and help text
    document.getElementById('search-box-container').style.display = 'block';
    document.getElementById('search-help-box').style.display = 'block';
    document.body.classList.add("search-help-hidden");

  </script>

</nav>

    

    <div class="container">

      <div class="page-header">
        <h1 class="module"><code><code><a href="mypy.html">mypy</a></code><wbr></wbr>.<code><a href="mypy.server.html">server</a></code><wbr></wbr>.<code><a href="mypy.server.deps.html">deps</a></code></code></h1>
        <div id="showPrivate">
          <button class="btn btn-link" onclick="togglePrivate()">Toggle Private API</button>
        </div>
      </div>

      <div class="categoryHeader">
        module documentation
      </div>

      <div class="extrasDocstring">
        <a href="https://github.com/python/mypy/tree/v0.930/mypy/server/deps.py" class="sourceLink">(source)</a>
        <p></p>
      </div>

      <div class="moduleDocstring">
        <div><p>Generate fine-grained dependencies for AST nodes, for use in the daemon mode.</p>
<p>Dependencies are stored in a map from <em>triggers</em> to <em>sets of affected locations</em>.</p>
<p>A trigger is a string that represents a program property that has changed, such
as the signature of a specific function. Triggers are written as '&lt;...&gt;' (angle
brackets). When a program property changes, we determine the relevant trigger(s)
and all affected locations. The latter are stale and will have to be reprocessed.</p>
<p>An affected location is a string than can refer to a <em>target</em> (a non-nested
function or method, or a module top level), a class, or a trigger (for
recursively triggering other triggers).</p>
<p>Here's an example representation of a simple dependency map (in format
"&lt;trigger&gt; -&gt; locations"):</p>
<blockquote>
&lt;m.A.g&gt; -&gt; m.f
&lt;m.A&gt; -&gt; &lt;m.f&gt;, m.A, m.f</blockquote>
<p>Assuming 'A' is a class, this means that</p>
<ol class="rst-arabic simple">
<li>if a property of 'm.A.g', such as the signature, is changed, we need
to process target (function) 'm.f'</li>
<li>if the MRO or other significant property of class 'm.A' changes, we
need to process target 'm.f', the entire class 'm.A', and locations
triggered by trigger '&lt;m.f&gt;' (this explanation is a bit simplified;
see below for more details).</li>
</ol>
<p>The triggers to fire are determined using mypy.server.astdiff.</p>
<p>Examples of triggers:</p>
<ul class="rst-simple">
<li>'&lt;mod.x&gt;' represents a module attribute/function/class. If any externally
visible property of 'x' changes, this gets fired. For changes within
classes, only "big" changes cause the class to be triggered (such as a
change in MRO). Smaller changes, such as changes to some attributes, don't
trigger the entire class.</li>
<li>'&lt;mod.Cls.x&gt;' represents the type and kind of attribute/method 'x' of
class 'mod.Cls'. This can also refer to an attribute inherited from a
base class (relevant if it's accessed through a value of type 'Cls'
instead of the base class type).</li>
<li>'&lt;package.mod&gt;' represents the existence of module 'package.mod'. This
gets triggered if 'package.mod' is created or deleted, or if it gets
changed into something other than a module.</li>
</ul>
<p>Examples of locations:</p>
<ul class="rst-simple">
<li>'mod' is the top level of module 'mod' (doesn't include any function bodies,
but includes class bodies not nested within a function).</li>
<li>'mod.f' is function 'f' in module 'mod' (module-level variables aren't separate
locations but are included in the module top level). Functions also include
any nested functions and classes -- such nested definitions aren't separate
locations, for simplicity of implementation.</li>
<li>'mod.Cls.f' is method 'f' of 'mod.Cls'. Non-method attributes aren't locations.</li>
<li>'mod.Cls' represents each method in class 'mod.Cls' + the top-level of the
module 'mod'. (To simplify the implementation, there is no location that only
includes the body of a class without the entire surrounding module top level.)</li>
<li>Trigger '&lt;...&gt;' as a location is an indirect way of referring to to all
locations triggered by the trigger. These indirect locations keep the
dependency map smaller and easier to manage.</li>
</ul>
<p>Triggers can be triggered by program changes such as these:</p>
<ul class="rst-simple">
<li>Addition or deletion of an attribute (or module).</li>
<li>Change of the kind of thing a name represents (such as a change from a function
to a class).</li>
<li>Change of the static type of a name.</li>
</ul>
<p>Changes in the body of a function that aren't reflected in the signature don't
cause the function to be triggered. More generally, we trigger only on changes
that may affect type checking results outside the module that contains the
change.</p>
<p>We don't generate dependencies from builtins and certain other stdlib modules,
since these change very rarely, and they would just increase the size of the
dependency map significantly without significant benefit.</p>
<p>Test cases for this module live in 'test-data/unit/deps*.test'.</p>
</div>
      </div>

      <div id="splitTables">
        <table class="children sortable" id="id553">
  
  
  <tr class="class">
    
    <td>Class</td>
    <td><code><a href="mypy.server.deps.DependencyVisitor.html">DependencyVisitor</a></code></td>
    <td><span class="undocumented">No class docstring; 0/8 instance variable, 8/50 methods documented</span></td>
  </tr><tr class="class">
    
    <td>Class</td>
    <td><code><a href="mypy.server.deps.TypeTriggersVisitor.html">TypeTriggersVisitor</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#dump_all_dependencies">dump_all_dependencies</a></code></td>
    <td><span>Generate dependencies for all interesting modules and print them to stdout.</span></td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#get_dependencies">get_dependencies</a></code></td>
    <td><span>Get all dependencies of a node, recursively.</span></td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#get_dependencies_of_target">get_dependencies_of_target</a></code></td>
    <td><span>Get dependencies of a target -- don't recursive into nested targets.</span></td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#get_type_triggers">get_type_triggers</a></code></td>
    <td><span>Return all triggers that correspond to a type becoming stale.</span></td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#has_user_bases">has_user_bases</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#merge_dependencies">merge_dependencies</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#non_trivial_bases">non_trivial_bases</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr>
</table>
        

          
      </div>

      <div id="childList">

        <div class="basefunction">
  
  
  <a name="mypy.server.deps.dump_all_dependencies">
    
  </a>
  <a name="dump_all_dependencies">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">dump_all_dependencies</span>(modules, type_map, python_version, options):
    <a class="sourceLink" href="https://github.com/python/mypy/tree/v0.930/mypy/server/deps.py#L1002">
      
      (source)
    </a>
  </div>
  <div class="docstring functionBody">
    
    
    <div>Generate dependencies for all interesting modules and print them to stdout.<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">modules:</span><code>Dict[<wbr></wbr>str, <wbr></wbr><a href="mypy.nodes.MypyFile.html">MypyFile</a>]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">type_map:</span><code>Dict[<wbr></wbr><a href="mypy.nodes.Expression.html">Expression</a>, <wbr></wbr><a href="mypy.types.Type.html">Type</a>]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">python_version:</span><code>Tuple[<wbr></wbr>int, <wbr></wbr>int]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">options:</span><code><a href="mypy.options.Options.html">Options</a></code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="mypy.server.deps.get_dependencies">
    
  </a>
  <a name="get_dependencies">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">get_dependencies</span>(target, type_map, python_version, options):
    <a class="sourceLink" href="https://github.com/python/mypy/tree/v0.930/mypy/server/deps.py#L111">
      
      (source)
    </a>
  </div>
  <div class="docstring functionBody">
    
    
    <div>Get all dependencies of a node, recursively.<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">target:</span><code><a href="mypy.nodes.MypyFile.html">MypyFile</a></code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">type_map:</span><code>Dict[<wbr></wbr><a href="mypy.nodes.Expression.html">Expression</a>, <wbr></wbr><a href="mypy.types.Type.html">Type</a>]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">python_version:</span><code>Tuple[<wbr></wbr>int, <wbr></wbr>int]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">options:</span><code><a href="mypy.options.Options.html">Options</a></code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>Dict[<wbr></wbr>str, <wbr></wbr>Set[<wbr></wbr>str]]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="mypy.server.deps.get_dependencies_of_target">
    
  </a>
  <a name="get_dependencies_of_target">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">get_dependencies_of_target</span>(module_id, module_tree, target, type_map, python_version):
    <a class="sourceLink" href="https://github.com/python/mypy/tree/v0.930/mypy/server/deps.py#L121">
      
      (source)
    </a>
  </div>
  <div class="docstring functionBody">
    
    
    <div>Get dependencies of a target -- don't recursive into nested targets.<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">module_id:</span><code>str</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">module_tree:</span><code><a href="mypy.nodes.MypyFile.html">MypyFile</a></code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">target:</span><code><a href="mypy.nodes.Node.html">Node</a></code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">type_map:</span><code>Dict[<wbr></wbr><a href="mypy.nodes.Expression.html">Expression</a>, <wbr></wbr><a href="mypy.types.Type.html">Type</a>]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">python_version:</span><code>Tuple[<wbr></wbr>int, <wbr></wbr>int]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>Dict[<wbr></wbr>str, <wbr></wbr>Set[<wbr></wbr>str]]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="mypy.server.deps.get_type_triggers">
    
  </a>
  <a name="get_type_triggers">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">get_type_triggers</span>(typ, use_logical_deps):
    <a class="sourceLink" href="https://github.com/python/mypy/tree/v0.930/mypy/server/deps.py#L864">
      
      (source)
    </a>
  </div>
  <div class="docstring functionBody">
    
    
    <div>Return all triggers that correspond to a type becoming stale.<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">typ:</span><code><a href="mypy.types.Type.html">Type</a></code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">use_logical_deps:</span><code>bool</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>List[<wbr></wbr>str]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="mypy.server.deps.has_user_bases">
    
  </a>
  <a name="has_user_bases">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">has_user_bases</span>(info):
    <a class="sourceLink" href="https://github.com/python/mypy/tree/v0.930/mypy/server/deps.py#L998">
      
      (source)
    </a>
  </div>
  <div class="docstring functionBody">
    
    
    <div><p class="undocumented">Undocumented</p><table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">info:</span><code><a href="mypy.nodes.TypeInfo.html">TypeInfo</a></code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>bool</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="mypy.server.deps.merge_dependencies">
    
  </a>
  <a name="merge_dependencies">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">merge_dependencies</span>(new_deps, deps):
    <a class="sourceLink" href="https://github.com/python/mypy/tree/v0.930/mypy/server/deps.py#L987">
      
      (source)
    </a>
  </div>
  <div class="docstring functionBody">
    
    
    <div><p class="undocumented">Undocumented</p><table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">new_deps:</span><code>Dict[<wbr></wbr>str, <wbr></wbr>Set[<wbr></wbr>str]]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">deps:</span><code>Dict[<wbr></wbr>str, <wbr></wbr>Set[<wbr></wbr>str]]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="mypy.server.deps.non_trivial_bases">
    
  </a>
  <a name="non_trivial_bases">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">non_trivial_bases</span>(info):
    <a class="sourceLink" href="https://github.com/python/mypy/tree/v0.930/mypy/server/deps.py#L993">
      
      (source)
    </a>
  </div>
  <div class="docstring functionBody">
    
    
    <div><p class="undocumented">Undocumented</p><table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">info:</span><code><a href="mypy.nodes.TypeInfo.html">TypeInfo</a></code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>List[<wbr></wbr><a href="mypy.nodes.TypeInfo.html">TypeInfo</a>]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div>

      </div>
    </div>

    <footer class="navbar navbar-default">
  
  <div class="container">
    <a href="index.html">API Documentation</a> for <a href="https://github.com/python/mypy" class="projecthome">mypy-0.930</a>,
  generated by <a href="https://github.com/twisted/pydoctor/">pydoctor</a>
    21.2.2 at 2022-01-06 17:36:40.
  </div>
</footer>

    <script src="pydoctor.js" type="text/javascript"></script>

  </body>
</html>